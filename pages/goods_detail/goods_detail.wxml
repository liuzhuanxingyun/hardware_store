<view class="container-detail">
  <!-- 保留这一行即可 -->
  <navigation-bar title="商品详情" back="{{true}}" color="#000" background="#fff"></navigation-bar>

  <scroll-view scroll-y class="content-scroll">
    <!-- 轮播图 -->
    <swiper class="detail-swiper" indicator-dots autoplay circular indicator-active-color="#ff6b00">
      <block wx:for="{{goods.detailImages}}" wx:key="*this">
        <swiper-item>
          <image src="{{item}}" mode="aspectFill" class="slide-image" />
        </swiper-item>
      </block>
    </swiper>

    <!-- 基本信息 -->
    <view class="info-box">
      <view class="price-row">
        <text class="symbol">￥</text>
        <text class="price">{{goods.price}}</text>
      </view>
      <view class="title">{{goods.name}}</view>
    </view>

    <!-- 详情介绍 -->
    <view class="detail-box">
      <view class="section-title">商品详情</view>
      <view class="desc-text">{{goods.description}}</view>
      <block wx:for="{{goods.detailImages}}" wx:key="*this">
        <image src="{{item}}" mode="widthFix" class="detail-img" />
      </block>
    </view>
    
    <!-- 底部垫高 -->
    <view style="height: 120rpx;"></view>
  </scroll-view>

  <!-- 底部操作栏 -->
  <view class="bottom-bar">
    <view class="icon-btn" bindtap="goHome">
      <image src="/images/home.png" mode="aspectFit" />
      <text>首页</text>
    </view>
    <view class="icon-btn">
      <image src="/images/cart.png" mode="aspectFit" />
      <text>购物车</text>
    </view>
    <view class="btn-group">
      <view class="btn add-cart" bindtap="showCartPopup">加入购物车</view>
      <view class="btn buy-now" bindtap="showBuyPopup">立即购买</view>
    </view>
  </view>

  <!-- 规格选择弹出层 -->
  <view class="mask" wx:if="{{showSpecPopup}}" bindtap="closePopup"></view>
  <view class="spec-popup {{showSpecPopup ? 'show' : ''}}">
    <view class="popup-header">
      <image src="{{goods.img}}" mode="aspectFill" class="popup-img"></image>
      <view class="popup-info">
        <view class="popup-price">￥{{currentPrice || goods.price}}</view>
        <view class="popup-selected">已选：{{currentSpec ? currentSpec.name : '请选择规格'}}</view>
      </view>
      <view class="close-btn" bindtap="closePopup">×</view>
    </view>

    <scroll-view scroll-y class="popup-content">
      <view class="spec-section">
        <view class="section-title">规格</view>
        <view class="spec-list">
          <block wx:for="{{goods.specs}}" wx:key="id">
            <view 
              class="spec-item {{currentSpec.id === item.id ? 'active' : ''}}" 
              bindtap="selectSpec" 
              data-spec="{{item}}">
              {{item.name}}
            </view>
          </block>
          <!-- 如果没有规格，显示默认 -->
          <view wx:if="{{!goods.specs || goods.specs.length === 0}}" class="spec-item active">标准规格</view>
        </view>
      </view>

      <view class="count-section">
        <view class="section-title">数量</view>
        <view class="stepper">
          <view class="step-btn minus {{buyCount <= 1 ? 'disabled' : ''}}" bindtap="changeCount" data-type="minus">-</view>
          <input class="step-input" type="number" value="{{buyCount}}" disabled />
          <view class="step-btn plus" bindtap="changeCount" data-type="plus">+</view>
        </view>
      </view>
    </scroll-view>

    <view class="popup-footer">
      <view class="confirm-btn" bindtap="confirmAction">确定</view>
    </view>
  </view>
</view>